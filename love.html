<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç‹æ˜Šå®‡&å¼ å˜‰è½©çš„æ‹çˆ±çºªå¿µæ˜Ÿçƒ</title>
    <!-- å¼•å…¥Firebaseï¼ˆåŠ asyncå¼‚æ­¥åŠ è½½ï¼Œä¸é˜»å¡ç™»å½•ï¼‰ -->
     
    <!-- ä»…ä¿ç•™è¿™2è¡ŒFirebaseå¼•å…¥ä»£ç ï¼ŒåŸç”Ÿç‰ˆæœ¬/æ— æ¨¡å—åŒ–è¯­æ³•/å…¼å®¹æ™®é€šHTML -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: "Microsoft YaHei", æ€æºé»‘ä½“, å¹¼åœ†, sans-serif; }
        body { background: linear-gradient(180deg, #fff9fb 0%, #fefbff 100%); color: #333; scroll-behavior: smooth; overflow-x: hidden; min-height: 100vh; padding-top: 90px; }
        /* é€šç”¨æ»šåŠ¨æ¡ç¾åŒ–ï¼ˆç‹¬ç«‹æ»‘åŠ¨åŒºåŸŸä¸“ç”¨ï¼‰ */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-thumb { background: #ff9ebb; border-radius: 10px; border: 1px solid #fff9fb; }
        ::-webkit-scrollbar-track { background: #fef1f4; border-radius: 10px; }
        /* ç‹¬ç«‹æ»‘åŠ¨å®¹å™¨åŸºç¡€æ ·å¼ */
        .scroll-box { overflow-y: auto; overflow-x: hidden; padding-right: 8px; scrollbar-width: thin; scrollbar-color: #ff9ebb #fef1f4; }
        a { text-decoration: none; color: #ff7a9d; transition: all 0.3s ease; }
        .container { width: 90%; max-width: 1200px; margin: 0 auto; padding: 30px 0; }
        /* é€šç”¨æŒ‰é’® */
        .btn { transition: all 0.3s ease; cursor: pointer; border: none; border-radius: 12px; background: #ff7a9d; color: #fff; padding: 10px 20px; font-size: 14px; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(255,122,157,0.2); background: #ff688f; }
        .btn-sm { padding: 6px 12px; font-size: 12px; border-radius: 8px; }
        .btn-light { background: #fef1f4; color: #ff7a9d; }
        .btn-light:hover { background: #ffe6ef; }
        .btn:disabled { background: #ffc0cf; cursor: not-allowed; transform: none; box-shadow: none; }
        /* é€šç”¨è¾“å…¥æ¡† */
        .input { flex: 1; min-width: 200px; padding: 10px 15px; border: 1px solid #fef1f4; border-radius: 10px; outline: none; transition: all 0.3s; font-size: 14px; color: #666; }
        .input:focus { border-color: #ff9ebb; box-shadow: 0 0 0 3px rgba(255,158,187,0.2); }
        .input-sm { padding: 6px 10px; font-size: 12px; min-width: 100px; }
        /* é€šç”¨åˆ é™¤æŒ‰é’® */
        .del { position: absolute; border: none; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s ease; }
        .del-sm { width: 20px; height: 20px; font-size: 10px; opacity: 0; }
        .del-md { width: 24px; height: 24px; font-size: 12px; }
        .item:hover .del-sm { opacity: 1; }
        /* é€šç”¨æ¨¡å—æ ‡é¢˜ */
        .section { padding: 60px 0; opacity: 0; transform: translateY(30px) scale(0.98); transition: all 0.6s cubic-bezier(0.22, 1, 0.36, 1); margin-top: 20px; }
        .section.show { opacity: 1; transform: translateY(0) scale(1); }
        .sec-title { text-align: center; font-size: 26px; margin-bottom: 10px; position: relative; font-weight: 600; padding-bottom: 10px; }
        .sec-title::after { content: ""; width: 70px; height: 3px; position: absolute; bottom: 0; left: 50%; transform: translateX(-50%); border-radius: 3px; }
        .sec-desc { text-align: center; color: #999; margin-bottom: 30px; font-size: 13px; line-height: 1.5; }
        /* é€šç”¨æ·»åŠ è¡¨å• */
        .add-form { background: #fff; border-radius: 15px; padding: 20px; box-shadow: 0 3px 15px rgba(0,0,0,0.05); margin-bottom: 30px; max-width: 900px; margin: 0 auto 30px; display: flex; flex-wrap: wrap; gap: 10px; align-items: center; }
        /* é€šç”¨å¡ç‰‡/é¡¹ */
        .item { position: relative; background: #fff; border-radius: 12px; transition: all 0.3s ease; }
        .item:hover { transform: translateY(-3px); box-shadow: 0 8px 20px rgba(0,0,0,0.08); }
        /* é€šç”¨å›¾ç‰‡å®¹å™¨ */
        .img-box { width: 100%; overflow: hidden; position: relative; cursor: pointer; display: flex; justify-content: center; align-items: center; background: #fef1f4; }
        .img-upload { position: absolute; bottom: 0; left: 0; width: 100%; background: rgba(0,0,0,0.5); color: #fff; font-size: 12px; text-align: center; line-height: 30px; opacity: 0; transition: all 0.3s ease; }
        .img-box:hover .img-upload { opacity: 1; }
        .img-input { display: none; }
        .img { width: 100%; height: 100%; object-fit: cover; transition: all 0.3s ease; }
        /* 1. å¯†ç ç™»å½•å±‚ */
        .login-mask { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, #ff7a9d33, #e8ccf733, #c8e6f733); backdrop-filter: blur(10px); z-index: 9999; display: flex; justify-content: center; align-items: center; flex-direction: column; gap: 20px; }
        .login-box { background: rgba(255,255,255,0.9); backdrop-filter: blur(15px); padding: 40px 30px; border-radius: 20px; box-shadow: 0 10px 30px rgba(255,122,157,0.1); border: 1px solid rgba(255,255,255,0.8); text-align: center; min-width: 300px; }
        .login-title { font-size: 22px; color: #ff7a9d; margin-bottom: 25px; }
        .login-input { width: 100%; margin-bottom: 15px; }
        .login-tip { font-size: 12px; color: #ff577f; height: 14px; margin-bottom: 10px; }
        /* å¯¼èˆªæ ï¼ˆæ ¸å¿ƒäº¤äº’ä¼˜åŒ–ï¼‰ */
        .nav { position: fixed; top: 0; left: 0; width: 100%; background: linear-gradient(180deg, rgba(255,249,251,0.98) 90%, transparent); backdrop-filter: blur(8px); z-index: 998; padding: 12px 0; border-bottom: 1px solid #ffe6ef; transition: all 0.4s ease; }
        .nav.scroll { background: rgba(255,249,251,0.98); box-shadow: 0 2px 8px rgba(255,122,157,0.05); }
        .nav-inner { display: flex; justify-content: space-between; align-items: center; width: 90%; margin: 0 auto; }
        .logo { font-size: 18px; font-weight: bold; color: #ff7a9d; text-shadow: 0 1px 3px rgba(255,122,157,0.1); }
        /* å¯¼èˆªèœå•äº¤äº’æ ¸å¿ƒï¼šhoveræ”¾å¤§+ç›¸é‚»è®©ä½ */
        .menu { display: flex; gap: 0; list-style: none; flex-wrap: wrap; align-items: center; }
        .menu li { position: relative; padding: 0 10px; transition: all 0.3s ease; transform-origin: center; }
        .menu a { font-size: 13px; color: #666; padding: 5px 8px; position: relative; display: inline-block; transition: all 0.3s ease; border-radius: 6px; }
        /* hoveræ”¾å¤§+èƒŒæ™¯é«˜äº®ï¼Œlié—´è·æ‰©å¤§å®ç°è®©ä½ */
        .menu li:hover { transform: scale(1.1); margin: 0 5px; }
        .menu li:hover a { color: #ff7a9d; background: #ffe6ef; }
        /* activeçŠ¶æ€æ”¾å¤§æ›´æ˜æ˜¾ï¼Œä¼˜å…ˆçº§æ›´é«˜ */
        .menu li.active { transform: scale(1.15); margin: 0 8px; z-index: 2; }
        .menu li.active a { color: #ff7a9d; background: #ffe6ef; font-weight: 500; }
        .menu li.active a::after { content: ""; position: absolute; bottom: 2px; left: 50%; transform: translateX(-50%); width: 80%; height: 2px; background: #ff7a9d; border-radius: 2px; }
        /* 2. åŠ¨æ€æ»šåŠ¨æ ï¼ˆæ˜¾ç¤ºæœ€æ–°ç•™è¨€ï¼‰ */
        .msg-scroll { position: fixed; top: 52px; left: 0; width: 100%; height: 36px; background: #ff7a9d; color: #fff; z-index: 997; overflow: hidden; white-space: nowrap; border-bottom: 1px solid #ff9ebb; }
        .msg-scroll-content { display: inline-block; line-height: 36px; font-size: 13px; padding-left: 100%; animation: scroll 40s linear infinite; }
        .msg-scroll-content span { margin: 0 20px; display: inline-block; }
        .msg-scroll-content span::before { content: "ğŸ’“ "; }
        /* 3. é¦–é¡µæ¬¢è¿åŒº */
        .hero { height: calc(100vh - 90px); background: linear-gradient(rgba(255,249,251,0.95), rgba(255,249,251,0.95)), url("https://picsum.photos/seed/love-hero/1200/800") no-repeat center center; background-size: cover; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; }
        .hero-title { font-size: 32px; color: #ff7a9d; margin-bottom: 15px; text-shadow: 0 2px 15px rgba(255,122,157,0.2); animation: fadeUp 1s ease; }
        .hero-slogan { font-size: 16px; color: #888; margin-bottom: 30px; animation: fadeUp 1s ease 0.2s both; }
        .timer { font-size: 36px; font-weight: bold; color: #ff7a9d; margin-bottom: 40px; background: rgba(255,255,255,0.85); backdrop-filter: blur(10px); padding: 15px 35px; border-radius: 18px; box-shadow: 0 5px 25px rgba(255,122,157,0.1); animation: fadeUp 1s ease 0.4s both; }
        /* 4. æˆ‘ä»¬çš„æ•…äº‹çº¿ï¼ˆç‹¬ç«‹æ»‘åŠ¨æ ¸å¿ƒï¼šå›ºå®šé«˜åº¦+scroll-boxï¼‰ */
        #story .sec-title { color: #ff7a9d; }
        #story .sec-title::after { background: #ff9ebb; }
        .story-timeline { position: relative; max-width: 1000px; margin: 0 auto; padding-left: 30px; height: 500px; /* å›ºå®šé«˜åº¦å®ç°ç‹¬ç«‹æ»‘åŠ¨ */ }
        @media (max-width: 768px) { .story-timeline { height: 300px; } }
        .story-timeline::after { content: ""; position: absolute; top: 0; bottom: 0; left: 10px; width: 2px; background: linear-gradient(to bottom, #ff9ebb, #ffe6ef); border-radius: 2px; }
        .story-item { padding: 0 0 30px 40px; position: relative; width: 100%; animation: fade 0.6s; }
        .story-item::after { content: ""; position: absolute; top: 0; left: 0; width: 22px; height: 22px; background: #fff; border: 3px solid #ff7a9d; border-radius: 50%; z-index: 1; transition: all 0.3s ease; box-shadow: 0 2px 5px rgba(255,122,157,0.2); }
        .story-item:hover::after { transform: scale(1.2); border-color: #ff688f; }
        .story-content { padding: 20px; background: #fff; border-radius: 15px; box-shadow: 0 3px 15px rgba(255,122,157,0.05); border-left: 3px solid #ff9ebb; position: relative; }
        .story-tag { font-size: 12px; color: white; background: linear-gradient(90deg, #ff9ebb, #ff7a9d); padding: 3px 8px; border-radius: 10px; display: inline-block; margin-bottom: 8px; cursor: pointer; }
        .story-time, .story-text { font-size: 13px; color: #ff7a9d; font-weight: 500; margin-bottom: 8px; cursor: pointer; }
        .story-text { color: #666; font-weight: normal; line-height: 1.6; margin-bottom: 12px; }
        .story-text:hover { color: #333; background: #fef1f4; padding: 2px 4px; border-radius: 4px; }
        .story-img-box { height: 200px; border-radius: 10px; }
        @media (max-width: 768px) { .story-img-box { height: 150px; } }
        /* 5. åˆç…§æ”¶è—ï¼ˆä¿®å¤ä¸Šä¼ BUGï¼Œæ ·å¼ä¼˜åŒ–ï¼‰ */
        #photo .sec-title { color: #9d8cff; }
        #photo .sec-title::after { background: #c8bfff; }
        .photo-cat { text-align: center; font-size: 18px; color: #9d8cff; margin: 30px 0 20px; font-weight: 500; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .photo-cat::before, .photo-cat::after { content: ""; width: 30px; height: 1px; background: #c8bfff; }
        .photo-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 15px; margin-bottom: 20px; }
        @media (max-width: 768px) { .photo-grid { grid-template-columns: repeat(2, 1fr); gap: 10px; } }
        @media (max-width: 480px) { .photo-grid { grid-template-columns: 1fr; } }
        .photo-item { box-shadow: 0 3px 15px rgba(157,140,255,0.05); }
        .photo-del { top: 8px; right: 8px; background: #f0e8ff; color: #9d8cff; }
        .photo-del:hover { background: #c8bfff; color: #fff; }
        .photo-img-box { height: 160px; border-radius: 12px 12px 0 0; }
        @media (max-width: 768px) { .photo-img-box { height: 120px; } }
        .photo-img-upload { line-height: 25px; font-size: 11px; }
        .photo-desc { padding: 8px; font-size: 12px; color: #666; text-align: center; line-height: 1.4; cursor: pointer; border-radius: 0 0 12px 12px; }
        .photo-desc:hover { background: #f0e8ff; color: #9d8cff; }
        /* 6. ä¸“å±çºªå¿µæ—¥ */
        #anniversary .sec-title { color: #68b8ff; }
        #anniversary .sec-title::after { background: #9ed0ff; }
        .anni-wrap { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; }
        @media (max-width: 768px) { .anni-wrap { grid-template-columns: 1fr; gap: 15px; } }
        .anni-card { border-radius: 15px; padding: 20px 15px; box-shadow: 0 3px 15px rgba(0,0,0,0.05); text-align: center; color: #333; border: 1px solid; }
        .color1 { background: linear-gradient(180deg, #fff0f5, #ffe6ef); border-color: #ff9ebb; }
        .color2 { background: linear-gradient(180deg, #f0e8ff, #e8ccf7); border-color: #c8bfff; }
        .color3 { background: linear-gradient(180deg, #e8f4f8, #d8eef8); border-color: #9ed0ff; }
        .color4 { background: linear-gradient(180deg, #f8fbe8, #e8f8d8); border-color: #a8e8c5; }
        .color5 { background: linear-gradient(180deg, #fff8e8, #fff2d8); border-color: #ffd89e; }
        .color6 { background: linear-gradient(180deg, #f8e8f8, #f0d8f0); border-color: #e8b8e8; }
        .anni-del { top: 10px; right: 10px; background: rgba(255,255,255,0.7); color: #666; }
        .anni-del:hover { background: #fff; color: #ff577f; transform: scale(1.1); }
        .anni-title { font-size: 16px; font-weight: 500; margin-bottom: 8px; cursor: pointer; }
        .anni-time { font-size: 12px; color: #777; margin-bottom: 15px; cursor: pointer; }
        .anni-count { font-size: 20px; font-weight: bold; margin: 8px 0; letter-spacing: 1px; }
        .color1 .anni-count { color: #ff7a9d; }
        .color2 .anni-count { color: #9d8cff; }
        .color3 .anni-count { color: #68b8ff; }
        .color4 .anni-count { color: #73d89f; }
        .color5 .anni-count { color: #ffb868; }
        .color6 .anni-count { color: #d873b8; }
        .anni-record { font-size: 11px; color: #777; line-height: 1.5; margin-top: 15px; text-align: left; padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.5); cursor: pointer; }
        /* 7. 100ä»¶å°äº‹ */
        #things .sec-title { color: #73d89f; }
        #things .sec-title::after { background: #a8e8c5; }
        .things-wrap { display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 10px; max-width: 1000px; margin: 0 auto; }
        @media (max-width: 768px) { .things-wrap { grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 8px; } }
        .things-item { padding: 12px 15px; box-shadow: 0 2px 10px rgba(115,216,159,0.05); display: flex; align-items: center; gap: 10px; border-left: 2px solid #a8e8c5; cursor: pointer; }
        .things-del { top: 8px; right: 8px; background: #e8f8d8; color: #73d89f; }
        .things-del:hover { background: #a8e8c5; color: #fff; }
        .things-check { width: 20px; height: 20px; border-radius: 50%; border: 2px solid #a8e8c5; display: flex; justify-content: center; align-items: center; flex-shrink: 0; transition: all 0.3s ease; background: #fff; }
        .things-check.done { background: linear-gradient(90deg, #73d89f, #a8e8c5); border-color: #73d89f; box-shadow: 0 1px 5px rgba(115,216,159,0.2); }
        .things-check.done::after { content: "âœ“"; color: white; font-size: 12px; font-weight: bold; animation: check 0.3s ease; }
        .things-text { font-size: 13px; color: #666; line-height: 1.5; padding-right: 15px; word-break: break-all; }
        /* 8. ç”œè¨€èœœè¯­ç•™è¨€æ¿ï¼ˆæ ¸å¿ƒBUGä¿®å¤+è§†è§‰åŒºåˆ†+ç‹¬ç«‹æ»‘åŠ¨ï¼‰ */
        #message .sec-title { color: #ffb868; }
        #message .sec-title::after { background: #ffd89e; }
        .msg-wrap { max-width: 800px; margin: 0 auto; }
        .msg-input { background: #fff; border-radius: 15px; padding: 20px; box-shadow: 0 3px 15px rgba(255,184,104,0.05); margin-bottom: 20px; border-left: 3px solid #ffd89e; }
        .role-select { display: flex; gap: 15px; margin-bottom: 10px; align-items: center; }
        .role-item { display: flex; align-items: center; gap: 6px; cursor: pointer; }
        .role-radio { width: 16px; height: 16px; accent-color: #ffb868; }
        .role-text { font-size: 13px; color: #666; transition: all 0.2s ease; }
        .role-item:hover .role-text { color: #ffb868; }
        .msg-textarea { width: 100%; height: 100px; border: 1px solid #fff8e8; border-radius: 10px; padding: 15px; font-size: 14px; color: #666; resize: none; margin-bottom: 10px; outline: none; transition: all 0.3s ease; background: #fff8e8; }
        .msg-textarea:focus { border-color: #ffd89e; box-shadow: 0 0 0 3px rgba(255,216,158,0.2); background: #fff; }
        /* ç•™è¨€åŒºç‹¬ç«‹æ»‘åŠ¨æ ¸å¿ƒï¼šå›ºå®šé«˜åº¦+scroll-boxï¼Œå§‹ç»ˆå®šä½æœ€æ–° */
        .msg-list { display: flex; flex-direction: column; gap: 15px; padding: 0 5px; height: 450px; /* å›ºå®šé«˜åº¦ */ max-height: 80vh; border-radius: 10px; }
        @media (max-width: 768px) { .msg-list { height: 300px; } }
        /* åŒæ–¹ç•™è¨€è§†è§‰å¼ºåŒºåˆ†ï¼šå¤´åƒ+èƒŒæ™¯+è¾¹æ¡†+åœ†è§’ */
        .msg-card { background: #fff; border-radius: 12px 12px 12px 3px; padding: 15px 15px 15px 45px; box-shadow: 0 2px 10px rgba(255,184,104,0.05); align-self: flex-start; max-width: 75%; animation: fade 0.5s ease; border-left: 2px solid #ffb868; position: relative; }
        .msg-card::before { content: ""; position: absolute; top: 15px; left: 15px; width: 24px; height: 24px; border-radius: 50%; background: #ffe6ef url(https://picsum.photos/seed/boy-avatar/100/100) no-repeat center; background-size: cover; border: 2px solid #ff9ebb; }
        .msg-card.yours { align-self: flex-end; background: #fff8e8; border-radius: 12px 12px 3px 12px; border-left: none; border-right: 2px solid #ffd89e; padding: 15px 45px 15px 15px; }
        .msg-card.yours::before { left: auto; right: 15px; background: #fef1f4 url(https://picsum.photos/seed/girl-avatar/100/100) no-repeat center; background-size: cover; border-color: #ffd89e; }
        .msg-del { top: 10px; right: 10px; width: 22px; height: 22px; background: rgba(255,255,255,0.7); color: #ff9ebb; font-size: 14px; opacity: 0.6; border-radius: 50%; }
        .msg-card.yours .msg-del { right: auto; left: 10px; color: #ffd89e; }
        .msg-del:hover { color: #ff7a9d; opacity: 1; transform: scale(1.1); background: #fff; }
        .msg-time { font-size: 11px; color: #ccc; margin-bottom: 8px; padding-right: 20px; }
        .msg-card.yours .msg-time { text-align: right; padding-right: 0; padding-left: 20px; }
        .msg-content { font-size: 14px; color: #666; line-height: 1.6; word-break: break-all; }
        /* 9. æƒ…ä¾£æ¡£æ¡ˆ */
        #couple .sec-title { color: #ff7a9d; }
        #couple .sec-title::after { background: #ff9ebb; }
        .couple-wrap { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 25px; max-width: 800px; margin: 0 auto; }
        @media (max-width: 768px) { .couple-wrap { grid-template-columns: 1fr; gap: 15px; } }
        .couple-card { border-radius: 15px; padding: 25px 20px; box-shadow: 0 3px 15px rgba(255,122,157,0.05); text-align: center; border: 1px solid; }
        .card-me { background: linear-gradient(180deg, #fefbff, #fff9fb); border-color: #ffe6ef; }
        .card-you { background: linear-gradient(180deg, #fff0f5, #fef1f4); border-color: #ff9ebb; }
        .avatar-box { width: 90px; height: 90px; border-radius: 50%; margin: 0 auto 15px; overflow: hidden; border: 3px solid #ffe6ef; box-shadow: 0 3px 10px rgba(255,122,157,0.1); transition: all 0.3s ease; position: relative; cursor: pointer; }
        .couple-card:hover .avatar-box { transform: scale(1.05); border-color: #ff9ebb; }
        .edit-text { font-size: 18px; color: #ff7a9d; margin-bottom: 10px; font-weight: 500; cursor: pointer; transition: all 0.2s ease; padding: 4px; border-radius: 6px; }
        .edit-text:hover { background: #ffe6ef; }
        .edit-sm { font-size: 13px; color: #666; margin: 0; font-weight: normal; }
        .edit-key { color: #999; }
        .edit-tag { font-size: 12px; color: #ff7a9d; background: #ffe6ef; padding: 4px 10px; border-radius: 15px; margin: 0 5px 8px; display: inline-block; position: relative; }
        .tag-del { position: absolute; top: -3px; right: -3px; width: 12px; height: 12px; border: none; background: #ff9ebb; color: #fff; border-radius: 50%; font-size: 8px; cursor: pointer; display: flex; align-items: center; justify-content: center; opacity: 0; transition: all 0.2s ease; }
        .edit-tag:hover .tag-del { opacity: 1; }
        .tag-del:hover { background: #ff7a9d; }
        .tag-add { display: flex; gap: 8px; align-items: center; margin-top: 10px; justify-content: center; }
        .couple-info { text-align: left; margin-top: 20px; padding-top: 15px; border-top: 1px solid #fef9fb; }
        .info-item { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #fef9fb; font-size: 13px; }
        .info-item:last-child { border-bottom: none; }
        .couple-tag { margin-top: 20px; display: flex; flex-wrap: wrap; gap: 8px; justify-content: center; }
        /* é¡µè„š+å›åˆ°é¡¶éƒ¨+ç…§ç‰‡é¢„è§ˆ */
        .footer { background: linear-gradient(180deg, #fff9fb, #fff0f5); padding: 40px 0 20px; text-align: center; margin-top: 60px; border-top: 1px solid #ffe6ef; }
        .footer-text { color: #ff9ebb; font-size: 15px; margin-bottom: 10px; line-height: 1.6; }
        .copyright { color: #ccc; font-size: 12px; }
        .back-top { position: fixed; bottom: 20px; right: 20px; width: 40px; height: 40px; border-radius: 50%; background: #ff7a9d; color: #fff; display: flex; justify-content: center; align-items: center; font-size: 18px; box-shadow: 0 3px 10px rgba(255,122,157,0.2); cursor: pointer; transition: all 0.3s ease; opacity: 0; visibility: hidden; z-index: 996; }
        @media (max-width: 768px) { .back-top { width: 35px; height: 35px; bottom: 15px; right: 15px; } }
        .back-top.show { opacity: 1; visibility: visible; }
        .back-top:hover { transform: translateY(-2px); background: #ff688f; box-shadow: 0 5px 15px rgba(255,122,157,0.3); }
        .photo-mask { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); backdrop-filter: blur(5px); display: none; justify-content: center; align-items: center; z-index: 9999; padding: 20px; }
        .photo-mask.show { display: flex; }
        .mask-img { max-width: 90%; max-height: 90vh; border-radius: 12px; box-shadow: 0 10px 50px rgba(0,0,0,0.3); }
        /* é€šç”¨åŠ¨ç”» */
        @keyframes scroll { 0% { transform: translateX(0); } 100% { transform: translateX(-100%); } }
        @keyframes fadeUp { 0% { opacity: 0; transform: translateY(20px); } 100% { opacity: 1; transform: translateY(0); } }
        @keyframes fade { 0% { opacity: 0; } 100% { opacity: 1; } }
        @keyframes check { 0% { transform: scale(0.5); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }
        /* å“åº”å¼å…¨å±€é€‚é… */
        @media (max-width: 768px) {
            .login-box { padding: 30px 20px; min-width: 260px; }
            .logo { font-size: 16px; }
            .menu li { padding: 0 6px; }
            .menu li:hover { margin: 0 3px; }
            .menu li.active { margin: 0 5px; }
            .msg-scroll { top: 48px; height: 32px; }
            .msg-scroll-content { line-height: 32px; font-size: 12px; }
            .hero { height: calc(100vh - 80px); }
            .hero-title { font-size: 26px; }
            .timer { font-size: 24px; padding: 12px 25px; border-radius: 15px; }
            .section { padding: 40px 0; }
            .sec-title { font-size: 22px; }
            .story-timeline { padding-left: 20px; }
            .story-item { padding-left: 30px; }
            .photo-cat { font-size: 16px; margin: 20px 0 15px; }
            .msg-card { max-width: 85%; padding: 12px 12px 12px 35px; }
            .msg-card.yours { padding: 12px 35px 12px 12px; }
            .msg-card::before, .msg-card.yours::before { width: 20px; height: 20px; }
            .add-form { flex-direction: column; align-items: stretch; }
            .input { min-width: 100%; }
        }
        @media (max-width: 480px) {
            .timer { font-size: 20px; padding: 10px 20px; }
            .hero-slogan { font-size: 14px; }
            .msg-scroll-content span { margin: 0 10px; }
            .add-form { padding: 15px; }
        }
    </style>
</head>
<body>
    <!-- å¯†ç ç™»å½• -->
    <div class="login-mask" id="loginMask">
        <div class="login-box">
            <h3 class="login-title">æ¬¢è¿æ¥åˆ°æ˜Šå®‡&å˜‰è½©çš„æ‹çˆ±æ˜Ÿçƒ</h3>
            <input type="password" class="input login-input" id="pwdInput" placeholder="è¯·è¾“å…¥è¿›å…¥å¯†ç ">
            <div class="login-tip" id="loginTip"></div>
            <button class="btn" onclick="checkPwd(this)">è¿›å…¥æ˜Ÿçƒ</button>
        </div>
    </div>

    <!-- å¯¼èˆªæ ï¼ˆäº¤äº’ä¼˜åŒ–ç‰ˆï¼‰ -->
    <nav class="nav" id="nav">
        <div class="nav-inner">
            <div class="logo">æ˜Šå®‡&å˜‰è½©çš„æ‹çˆ±æ˜Ÿçƒ</div>
            <ul class="menu">
                <li><a href="#story" class="nav-link">æˆ‘ä»¬çš„æ•…äº‹</a></li>
                <li><a href="#photo" class="nav-link">åˆç…§æ”¶è—</a></li>
                <li><a href="#anniversary" class="nav-link">ä¸“å±çºªå¿µæ—¥</a></li>
                <li><a href="#things" class="nav-link">100ä»¶å°äº‹</a></li>
                <li><a href="#message" class="nav-link">ç”œè¨€èœœè¯­</a></li>
                <li><a href="#couple" class="nav-link">æƒ…ä¾£æ¡£æ¡ˆ</a></li>
            </ul>
        </div>
    </nav>

    <!-- åŠ¨æ€æ»šåŠ¨æ ï¼ˆæ˜¾ç¤ºæœ€æ–°ç•™è¨€ï¼Œéå›ºå®šï¼‰ -->
    <div class="msg-scroll" id="msgScroll">
        <div class="msg-scroll-content" id="msgScrollContent">
            <span>æ¬¢è¿æ¥åˆ°æˆ‘ä»¬çš„æ‹çˆ±æ˜Ÿçƒï¼Œå†™ä¸‹ç¬¬ä¸€æ¡ç”œè¨€èœœè¯­å§ï½</span>
        </div>
    </div>

    <!-- é¦–é¡µ -->
    <section class="hero" id="hero">
        <h1 class="hero-title">ç‹æ˜Šå®‡ & å¼ å˜‰è½©</h1>
        <p class="hero-slogan">ä¸‰é¤å››å­£ï¼Œå²å²å¹´å¹´ï¼Œä»é‡è§å¼€å§‹ï¼Œä½™ç”Ÿéƒ½æ˜¯ä½ </p>
        <div class="timer" id="loveTimer">0å¤©0æ—¶0åˆ†0ç§’</div>
        <button class="btn" onclick="document.querySelector('#story').scrollIntoView({behavior:'smooth'})">è¿›å…¥æˆ‘ä»¬çš„æ•…äº‹</button>
    </section>

    <!-- æˆ‘ä»¬çš„æ•…äº‹çº¿ï¼ˆç‹¬ç«‹æ»‘åŠ¨ç‰ˆï¼‰ -->
    <section class="section" id="story">
        <div class="container">
            <h2 class="sec-title">æˆ‘ä»¬çš„æ•…äº‹çº¿</h2>
            <p class="sec-desc">ä»ç›¸é‡çš„å¿ƒåŠ¨ï¼Œåˆ°ç›¸å®ˆçš„æ¸©æŸ”ï¼Œæ¯ä¸€ä¸ªç¬é—´éƒ½å€¼å¾—çè—</p>
            <div class="add-form">
                <input type="text" class="input input-sm" id="storyTag" placeholder="æ•…äº‹æ ‡ç­¾ï¼ˆå¦‚ï¼šğŸ’“ åˆæ¬¡ç›¸é‡ï¼‰">
                <input type="text" class="input input-sm" id="storyTime" placeholder="æ—¶é—´ï¼ˆå¦‚ï¼š2023å¹´12æœˆ6æ—¥ï¼‰">
                <input type="text" class="input" id="storyText" placeholder="æ•…äº‹å†…å®¹">
                <button class="btn" onclick="addData('stories', {tag:storyTag.value,time:storyTime.value,text:storyText.value,img:'https://picsum.photos/seed/love-new/500/500'})">æ·»åŠ æ•…äº‹</button>
            </div>
            <div class="story-timeline scroll-box" id="storyTimeline"></div>
        </div>
    </section>

    <!-- åˆç…§æ”¶è—å¤¹ï¼ˆä¿®å¤ä¸Šä¼ BUGï¼‰ -->
    <section class="section" id="photo">
        <div class="container">
            <h2 class="sec-title">åˆç…§æ”¶è—å¤¹</h2>
            <p class="sec-desc">æŠŠæ¯ä¸€ä¸ªç”œèœœç¬é—´ï¼Œéƒ½è—åœ¨æ—¶å…‰é‡Œ</p>
            <!-- æ—¥å¸¸ -->
            <h3 class="photo-cat">ğŸ“¸ æ—¥å¸¸ç‚¹æ»´</h3>
            <div class="add-form"><button class="btn btn-light" onclick="addData('photos', {type:'daily',data:{img:'https://picsum.photos/seed/love-photo/500/500',desc:'è¯·ç¼–è¾‘æè¿°ï½'}})">æ·»åŠ æ—¥å¸¸åˆç…§</button></div>
            <div class="photo-grid" id="photoDaily"></div>
            <!-- æ—…è¡Œ -->
            <h3 class="photo-cat">âœˆï¸ æ—…è¡Œæ‰“å¡</h3>
            <div class="add-form"><button class="btn btn-light" onclick="addData('photos', {type:'travel',data:{img:'https://picsum.photos/seed/love-photo/500/500',desc:'è¯·ç¼–è¾‘æè¿°ï½'}})">æ·»åŠ æ—…è¡Œåˆç…§</button></div>
            <div class="photo-grid" id="photoTravel"></div>
            <!-- èŠ‚æ—¥ -->
            <h3 class="photo-cat">ğŸ èŠ‚æ—¥çºªå¿µ</h3>
            <div class="add-form"><button class="btn btn-light" onclick="addData('photos', {type:'holiday',data:{img:'https://picsum.photos/seed/love-photo/500/500',desc:'è¯·ç¼–è¾‘æè¿°ï½'}})">æ·»åŠ èŠ‚æ—¥åˆç…§</button></div>
            <div class="photo-grid" id="photoHoliday"></div>
        </div>
    </section>

    <!-- ä¸“å±çºªå¿µæ—¥ -->
    <section class="section" id="anniversary">
        <div class="container">
            <h2 class="sec-title">ä¸“å±çºªå¿µæ—¥</h2>
            <p class="sec-desc">é‡è¦çš„æ—¥å­ï¼Œæ°¸è¿œä¸ä¼šå¿˜è®°ï¼Œæ¯å¹´éƒ½è¦ä¸€èµ·åº†ç¥</p>
            <div class="add-form">
                <input type="text" class="input" id="anniName" placeholder="çºªå¿µæ—¥åç§°ï¼ˆå¦‚ï¼šåœ¨ä¸€èµ·çºªå¿µæ—¥ï¼‰">
                <input type="text" class="input input-sm" id="anniDate" placeholder="æ—¥æœŸï¼ˆæœˆ-æ—¥ï¼Œå¦‚ï¼š12-6ï¼‰">
                <input type="text" class="input" id="anniRecord" placeholder="å†å¹´è®°å½•ï¼ˆé€‰å¡«ï¼‰">
                <button class="btn" onclick="addData('anniversaries', {name:anniName.value,date:anniDate.value,record:anniRecord.value||'å¾…æ·»åŠ è®°å½•ï½'})">æ·»åŠ çºªå¿µæ—¥</button>
            </div>
            <div class="anni-wrap" id="anniWrap"></div>
        </div>
    </section>

    <!-- 100ä»¶å°äº‹ -->
    <section class="section" id="things">
        <div class="container">
            <h2 class="sec-title">æˆ‘ä»¬çš„100ä»¶å°äº‹</h2>
            <p class="sec-desc">ä¸€èµ·å®Œæˆï¼Œä¸€èµ·è§£é”ï¼ŒæŠŠå¹³å‡¡çš„æ—¥å­è¿‡æˆè¯—</p>
            <div class="add-form things-add">
                <input type="text" class="input" id="thingsText" placeholder="è¾“å…¥è¦ä¸€èµ·åšçš„å°äº‹">
                <button class="btn" onclick="addData('things', {text:thingsText.value,done:false})">æ·»åŠ å°äº‹</button>
            </div>
            <div class="things-wrap" id="thingsWrap"></div>
        </div>
    </section>

    <!-- ç”œè¨€èœœè¯­ç•™è¨€æ¿ï¼ˆBUGä¿®å¤+è§†è§‰åŒºåˆ†+ç‹¬ç«‹æ»‘åŠ¨ï¼‰ -->
    <section class="section" id="message">
        <div class="container">
            <h2 class="sec-title">ç”œè¨€èœœè¯­ç•™è¨€æ¿</h2>
            <p class="sec-desc">æŠŠæƒ³è¯´çš„è¯è—åœ¨è¿™é‡Œï¼ŒåŒå‘å¥”èµ´çš„æ¸©æŸ”</p>
            <div class="msg-wrap">
                <div class="msg-input">
                    <div class="role-select">
                        <div class="role-item">
                            <input type="radio" name="role" id="roleMe" class="role-radio" checked>
                            <label for="roleMe" class="role-text">æ˜Šå®‡</label>
                        </div>
                        <div class="role-item">
                            <input type="radio" name="role" id="roleYou" class="role-radio">
                            <label for="roleYou" class="role-text">å˜‰è½©</label>
                        </div>
                    </div>
                    <textarea class="msg-textarea" id="msgInput" placeholder="å†™ä¸‹æƒ³å¯¹å¯¹æ–¹è¯´çš„ç”œè¨€èœœè¯­å§ï½"></textarea>
                    <button class="btn" onclick="sendMsg()">å‘é€ç”œèœœ</button>
                </div>
                <div class="msg-list scroll-box" id="msgList"></div>
            </div>
        </div>
    </section>

    <!-- æƒ…ä¾£æ¡£æ¡ˆ -->
    <section class="section" id="couple">
        <div class="container">
            <h2 class="sec-title">æƒ…ä¾£ä¸“å±æ¡£æ¡ˆ</h2>
            <p class="sec-desc">è—ç€å½¼æ­¤çš„å°ç»†èŠ‚ï¼ŒåŸæ¥æˆ‘è¿™ä¹ˆäº†è§£ä½ </p>
            <div class="couple-wrap">
                <!-- æ˜Šå®‡ -->
                <div class="couple-card card-me" id="coupleMe">
                    <div class="avatar-box" onclick="document.getElementById('avatarMeInput').click()">
                        <img src="https://picsum.photos/seed/boy/100/100" alt="æ˜Šå®‡" class="img" id="avatarMe">
                        <div class="img-upload">æ›´æ¢å¤´åƒ</div>
                        <input type="file" class="img-input" id="avatarMeInput" accept="image/*" onchange="uploadImg('avatar_me', 'avatarMe', this)">
                    </div>
                    <div class="edit-text" id="meName" onclick="editText(this)">ç‹æ˜Šå®‡</div>
                    <div class="couple-info">
                        <div class="info-item"><span class="edit-text edit-key" onclick="editText(this)">ç”Ÿæ—¥</span><span class="edit-text edit-sm" onclick="editText(this)">Xå¹´XæœˆXæ—¥</span></div>
                        <div class="info-item"><span class="edit-text edit-key" onclick="editText(this)">æ˜Ÿåº§</span><span class="edit-text edit-sm" onclick="editText(this)">XXåº§</span></div>
                        <div class="info-item"><span class="edit-text edit-key" onclick="editText(this)">å°ç™–å¥½</span><span class="edit-text edit-sm" onclick="editText(this)">å¾…ç¼–è¾‘ï½</span></div>
                        <div class="info-item"><span class="edit-text edit-key" onclick="editText(this)">å°ä¼˜ç‚¹</span><span class="edit-text edit-sm" onclick="editText(this)">å¾…ç¼–è¾‘ï½</span></div>
                    </div>
                    <div class="couple-tag" id="meTag">
                        <span class="edit-tag">å® å¦»ç‹‚é­”<span class="tag-del" onclick="this.parentElement.remove()">Ã—</span></span>
                        <span class="edit-tag">å¹²é¥­æ­å­<span class="tag-del" onclick="this.parentElement.remove()">Ã—</span></span>
                    </div>
                    <div class="tag-add">
                        <input type="text" class="input input-sm" id="meTagInput" placeholder="æ·»åŠ æ ‡ç­¾">
                        <button class="btn btn-sm" onclick="addTag('meTag', meTagInput)">+</button>
                    </div>
                </div>
                <!-- å˜‰è½© -->
                <div class="couple-card card-you" id="coupleYou">
                    <div class="avatar-box" onclick="document.getElementById('avatarYouInput').click()">
                        <img src="https://picsum.photos/seed/girl/100/100" alt="å˜‰è½©" class="img" id="avatarYou">
                        <div class="img-upload">æ›´æ¢å¤´åƒ</div>
                        <input type="file" class="img-input" id="avatarYouInput" accept="image/*" onchange="uploadImg('avatar_you', 'avatarYou', this)">
                    </div>
                    <div class="edit-text" id="youName" onclick="editText(this)">å¼ å˜‰è½©</div>
                    <div class="couple-info">
                        <div class="info-item"><span class="edit-text edit-key" onclick="editText(this)">ç”Ÿæ—¥</span><span class="edit-text edit-sm" onclick="editText(this)">Xå¹´XæœˆXæ—¥</span></div>
                        <div class="info-item"><span class="edit-text edit-key" onclick="editText(this)">æ˜Ÿåº§</span><span class="edit-text edit-sm" onclick="editText(this)">XXåº§</span></div>
                        <div class="info-item"><span class="edit-text edit-key" onclick="editText(this)">å°ç™–å¥½</span><span class="edit-text edit-sm" onclick="editText(this)">å¾…ç¼–è¾‘ï½</span></div>
                        <div class="info-item"><span class="edit-text edit-key" onclick="editText(this)">å°ä¼˜ç‚¹</span><span class="edit-text edit-sm" onclick="editText(this)">å¾…ç¼–è¾‘ï½</span></div>
                    </div>
                    <div class="couple-tag" id="youTag">
                        <span class="edit-tag">å¯çˆ±è½¯èŒ<span class="tag-del" onclick="this.parentElement.remove()">Ã—</span></span>
                        <span class="edit-tag">å¥¶èŒ¶æ­å­<span class="tag-del" onclick="this.parentElement.remove()">Ã—</span></span>
                    </div>
                    <div class="tag-add">
                        <input type="text" class="input input-sm" id="youTagInput" placeholder="æ·»åŠ æ ‡ç­¾">
                        <button class="btn btn-sm" onclick="addTag('youTag', youTagInput)">+</button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- é¡µè„š -->
    <footer class="footer">
        <div class="footer-text">ç‹æ˜Šå®‡&å¼ å˜‰è½© æ„¿å²å²å¹´å¹´ï¼Œæ»¡å¿ƒæ¬¢å–œï¼Œå…±èµ´ç™½å¤´</div>
        <div class="copyright">Â©2025 ä¸“å±æ‹çˆ±çºªå¿µæ˜Ÿçƒ Â· æ‰€æœ‰ç”œèœœçš†ä¸ºä¸“å±</div>
    </footer>

    <!-- å›åˆ°é¡¶éƒ¨+ç…§ç‰‡é¢„è§ˆ -->
    <div class="back-top" id="backTop" onclick="window.scrollTo({top:0,behavior:'smooth'})">â†‘</div>
    <div class="photo-mask" id="photoMask" onclick="this.classList.remove('show')">
        <img src="" alt="é¢„è§ˆ" class="mask-img" id="maskImg">
    </div>

    <script>
        // === æ ¸å¿ƒé…ç½®ï¼ˆç‹¬ç«‹äºFirebaseï¼Œç¡®ä¿ç™»å½•ä¼˜å…ˆï¼‰ ===
        const PWD = "231206", LOVE_START = new Date(2023, 11, 6, 19, 34);
        // åˆå§‹æ•°æ®ï¼ˆé¦–æ¬¡åŠ è½½ç”¨ï¼Œåç»­ä»äº‘ç«¯è·å–ï¼‰
        const initData = {
            stories: [{tag:"ğŸ’“ åˆæ¬¡ç›¸é‡",time:"2023å¹´ç§‹",text:"é‡è§ä½ çš„é‚£ä¸€åˆ»ï¼Œæ˜Ÿæ²³çš†æ˜ï¼Œä»æ­¤æ»¡å¿ƒçš†æ˜¯ä½ ",img:"https://picsum.photos/seed/love-meet/500/500"},{tag:"ğŸ’ å‘Šç™½ç¬é—´",time:"2023å¹´12æœˆ6æ—¥",text:"æ­£å¼å‘Šç™½ï¼Œç¡®å®šå½¼æ­¤ï¼Œä»æ­¤ä¸‰é¤å››å­£ï¼Œå²å²å¹´å¹´éƒ½æ˜¯ä½ ",img:"https://picsum.photos/seed/love-propose/500/500"}],
            photos: {daily:[{img:"https://picsum.photos/seed/love-daily1/500/500",desc:"ä¸€èµ·çªæ²™å‘è¿½å‰§"}],travel:[{img:"https://picsum.photos/seed/love-travel1/500/500",desc:"ä¸€èµ·å»çœ‹æµ·"}],holiday:[{img:"https://picsum.photos/seed/love-holiday1/500/500",desc:"ç¬¬ä¸€ä¸ªæƒ…äººèŠ‚"}]},
            anniversaries: [{name:"åœ¨ä¸€èµ·çºªå¿µæ—¥",date:"12-6",record:"2023å¹´ï¼šæ­£å¼åœ¨ä¸€èµ·<br>å²å²å¹´å¹´ï¼Œå¦‚çº¦è€Œè‡³"},{name:"æƒ…äººèŠ‚",date:"2-14",record:"å¾…è§£é”ç”œèœœæ—¶å…‰ï½"}],
            things: [{text:"ä¸€èµ·çœ‹ä¸€åœºæµªæ¼«çš„ç”µå½±",done:false},{text:"ä¸€èµ·åšä¸€é¡¿ä¸°ç››çš„æ™šé¤",done:false},{text:"ä¸€èµ·å»æµ·è¾¹çœ‹æ—¥å‡ºæ—¥è½",done:false},{text:"ä¸€èµ·ç‰µæ‰‹å‹é©¬è·¯èŠåˆ°æ·±å¤œ",done:false}],
            messages: [{role:"me",text:"å®è´ï¼Œé‡è§ä½ æ˜¯æˆ‘è¿™è¾ˆå­æœ€å¹¸è¿çš„äº‹ï½",time:"2023-12-06 19:34"},{role:"you",text:"æ˜Šå®‡ï¼Œä½™ç”Ÿè¯·å¤šæŒ‡æ•™å•¦ï½",time:"2023-12-06 19:36"}],
            avatar_me: "https://picsum.photos/seed/boy/100/100",
            avatar_you: "https://picsum.photos/seed/girl/100/100"
        };

        // === Firebaseé…ç½®åŒº === ã€è‹¥éœ€äº‘ç«¯åŒæ­¥ï¼Œæ›¿æ¢ä¸ºè‡ªå·±çš„é…ç½®å³å¯ã€‘
        const firebaseConfig = {
            apiKey: "AIzaSyDk6U2HI1VjElDzItZ4CSbF6RiMKvyVxL0",
            authDomain: "love-c729d.firebaseapp.com",
            databaseURL:"https://love-c729d-default-rtdb.asia-southeast1.firebasedatabase.app/",
            projectId: "love-c729d",
            storageBucket: "love-c729d.firebasestorage.app",
            messagingSenderId: "649634122960",
            appId: "1:649634122960:web:0fdbac02592fed687262d5",
            measurementId: "G-LL5NVJKJ24"
        };
        // åˆå§‹åŒ–Firebaseï¼ˆåšå¼‚å¸¸æ•è·ï¼Œå¤±è´¥ä¸å½±å“ç™»å½•ï¼‰
        let db;
        try {
            firebase.initializeApp(firebaseConfig);
            db = firebase.database().ref(); // å®æ—¶æ•°æ®åº“æ ¹èŠ‚ç‚¹
        } catch (e) {
            console.log("Firebaseåˆå§‹åŒ–å¤±è´¥ï¼Œå°†ä½¿ç”¨æœ¬åœ°åˆå§‹æ•°æ®ï¼š", e);
        }

        // äº‘ç«¯æ•°æ®å·¥å…·ï¼ˆæ›¿ä»£åŸlocalStorageï¼Œå®ç°åŒæ–¹åŒæ­¥ï¼‰
        // ä»äº‘ç«¯è·å–æ•°æ®ï¼ˆå¤±è´¥è¿”å›åˆå§‹æ•°æ®ï¼‰
        async function getCloudData(key) {
            if (!db) return initData[key];
            try {
                const snap = await db.child(key).get();
                return snap.exists() ? snap.val() : initData[key];
            } catch (e) {
                console.log("è·å–äº‘ç«¯æ•°æ®å¤±è´¥ï¼Œä½¿ç”¨åˆå§‹æ•°æ®ï¼š", e);
                return initData[key];
            }
        }
        // å‘äº‘ç«¯è®¾ç½®æ•°æ®ï¼ˆå¤±è´¥ç»™å‡ºæç¤ºï¼‰
        async function setCloudData(key, data) {
            if (!db) {
                alert("æœªå¼€å¯äº‘ç«¯åŒæ­¥ï¼Œæ•°æ®ä»…æœ¬åœ°ç”Ÿæ•ˆï½");
                return true;
            }
            try {
                await db.child(key).set(data);
                return true;
            } catch (e) {
                console.log("è®¾ç½®äº‘ç«¯æ•°æ®å¤±è´¥ï¼š", e);
                alert("æ•°æ®åŒæ­¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–Firebaseé…ç½®ï½");
                return false;
            }
        }
        // åˆå§‹åŒ–äº‘ç«¯æ•°æ®ï¼ˆé¦–æ¬¡åŠ è½½æ—¶ï¼Œè‹¥äº‘ç«¯æ— æ•°æ®åˆ™å†™å…¥åˆå§‹æ•°æ®ï¼‰
        async function initCloudData() {
            if (!db) return;
            try {
                const snap = await db.get();
                if (!snap.exists()) await db.set(initData);
            } catch (e) {
                console.log("åˆå§‹åŒ–äº‘ç«¯æ•°æ®å¤±è´¥ï¼š", e);
            }
        }

        // é¡µé¢åˆå§‹åŒ–ï¼ˆå¼‚æ­¥ï¼Œå…ˆåˆå§‹åŒ–äº‘ç«¯ï¼Œç¡®ä¿ç™»å½•é€»è¾‘ä¼˜å…ˆæ‰§è¡Œï¼‰
        window.onload = async () => {
            await initCloudData();
            initTimer(); 
            await renderAll(); 
            initScroll(); 
            initPreview();
            // ç»‘å®šå›è½¦äº‹ä»¶ï¼ˆå¯†ç æ¡†+ç•™è¨€æ¡†ï¼‰
            const pwdInput = document.getElementById("pwdInput");
            const msgInput = document.getElementById("msgInput");
            pwdInput && pwdInput.addEventListener("keydown", e => e.key === "Enter" && checkPwd(document.querySelector(".login-box .btn")));
            msgInput && msgInput.addEventListener("keydown", e => e.key === "Enter" && !e.shiftKey && (e.preventDefault(), sendMsg()));
            // å®æ—¶ç›‘å¬ç•™è¨€å˜åŒ–ï¼Œæ›´æ–°æ»šåŠ¨æ ï¼ˆFirebaseå¯ç”¨æ—¶ï¼‰
            if (db) {
                db.child("messages").on("value", async () => { 
                    await renderMsg(); 
                    updateScrollMsg(); 
                });
            }
        };

        // 1. å¯†ç éªŒè¯ã€æ ¸å¿ƒä¿®å¤ï¼šæ— å“åº”BUG+é˜²é‡å¤ç‚¹å‡»+DOMæ ¡éªŒã€‘
        function checkPwd(btn) {
            // å¼ºåˆ¶è·å–DOMï¼Œé¿å…æœªå®šä¹‰
            const pwdInput = document.getElementById("pwdInput");
            const loginTip = document.getElementById("loginTip");
            const loginMask = document.getElementById("loginMask");
            const sections = document.querySelectorAll(".section");
            
            // é˜²é‡å¤ç‚¹å‡»ï¼šç¦ç”¨æŒ‰é’®
            btn.disabled = true;
            btn.innerText = "éªŒè¯ä¸­...";
            loginTip.innerText = "";

            // è·å–å¹¶æ ¡éªŒå¯†ç 
            const val = pwdInput ? pwdInput.value.trim() : "";
            if (!val) {
                loginTip.innerText = "è¯·è¾“å…¥å¯†ç ï½";
                btn.disabled = false;
                btn.innerText = "è¿›å…¥æ˜Ÿçƒ";
                return;
            }
            // å¯†ç æ­£ç¡®
            if (val === PWD) { 
                // éšè—ç™»å½•å±‚
                if (loginMask) loginMask.style.display = "none"; 
                // æ˜¾ç¤ºæ‰€æœ‰æ¨¡å—
                sections.forEach(s => s.classList.add("show"));
                // æ¸…ç©ºå¯†ç æ¡†
                pwdInput.value = "";
            } 
            // å¯†ç é”™è¯¯
            else { 
                loginTip.innerText = "å¯†ç é”™è¯¯ï½"; 
                pwdInput.value = "";
                btn.disabled = false;
                btn.innerText = "è¿›å…¥æ˜Ÿçƒ";
            }
        }

        // 2. æ‹çˆ±è®¡æ—¶ï¼ˆå®æ—¶æ›´æ–°ï¼Œç‹¬ç«‹è¿è¡Œï¼‰
        function initTimer() {
            const timerEl = document.getElementById("loveTimer");
            if (!timerEl) return;
            const update = () => {
                const diff = new Date() - LOVE_START;
                const d = Math.floor(diff / 86400000), h = Math.floor((diff % 86400000) / 3600000);
                const m = Math.floor((diff % 3600000) / 60000), s = Math.floor((diff % 60000) / 1000);
                timerEl.innerText = `${d}å¤©${h}æ—¶${m}åˆ†${s}ç§’`;
            };
            update(); 
            setInterval(update, 1000);
        }

        // 3. é€šç”¨å¢åˆ æ”¹ï¼ˆäº‘ç«¯ç‰ˆï¼Œå…¼å®¹æœ¬åœ°ï¼‰
        async function addData(type, data) {
            // éªŒè¯å¿…å¡«é¡¹
            const tagVal = data.tag ? data.tag.trim() : "";
            const nameVal = data.name ? data.name.trim() : "";
            const textVal = data.text ? data.text.trim() : "";
            if ((type === "stories" && !tagVal) || (type === "anniversaries" && !nameVal) || (type === "things" && !textVal)) {
                alert("æ ¸å¿ƒå†…å®¹ä¸èƒ½ä¸ºç©ºå“¦ï½"); 
                return;
            }
            // 100ä»¶å°äº‹æ•°é‡é™åˆ¶
            if (type === "things") {
                const list = await getCloudData("things");
                if (list.length >= 100) { 
                    alert("ğŸ’“ 100ä»¶å°äº‹å·²æ”¶é›†æ»¡ï¼Œä½™ç”Ÿæ…¢æ…¢å®Œæˆï½"); 
                    return; 
                }
            }
            // çºªå¿µæ—¥æ—¥æœŸæ ¼å¼éªŒè¯
            if (type === "anniversaries" && !/^\d{1,2}-\d{1,2}$/.test(data.date.trim())) {
                alert("æ—¥æœŸæ ¼å¼è¯·å¡«å†™ æœˆ-æ—¥ï¼Œå¦‚ï¼š12-6ï½"); 
                return;
            }
            
            let res = await getCloudData(type);
            // å¤„ç†ç…§ç‰‡çš„åˆ†ç±»æ·»åŠ 
            if (type === "photos") { 
                if (!res[data.type]) res[data.type] = [];
                res[data.type].push(data.data); 
            } else { 
                res.push(data); 
            }
            // å†™å…¥äº‘ç«¯å¹¶é‡æ–°æ¸²æŸ“
            if (await setCloudData(type, res)) {
                await renderAll();
                // æ¸…ç©ºå¯¹åº”è¾“å…¥æ¡†
                const inputIds = [`${type}Tag`, `${type}Time`, `${type}Text`, "anniName", "anniDate", "anniRecord", "thingsText"];
                inputIds.forEach(id => {
                    const el = document.getElementById(id);
                    el && (el.value = "");
                });
            }
        }

        async function delData(type, idx, subType) {
            if (!confirm("ç¡®å®šè¦åˆ é™¤è¿™ä»½ç”œèœœå›å¿†å—ï¼Ÿ")) return;
            let res = await getCloudData(type);
            // å¤„ç†ç…§ç‰‡çš„åˆ†ç±»åˆ é™¤
            if (subType && res[subType]) {
                res[subType].splice(idx, 1);
            } else if (Array.isArray(res)) {
                res.splice(idx, 1);
            }
            // å†™å…¥äº‘ç«¯å¹¶é‡æ–°æ¸²æŸ“
            if (await setCloudData(type, res)) await renderAll();
        }

        async function editData(type, idx, key, subType) {
            const res = await getCloudData(type);
            // è·å–åŸå§‹å€¼
            const oldVal = subType ? (res[subType][idx] ? res[subType][idx][key] : "") : (res[idx] ? res[idx][key] : "");
            const title = key === 'tag' ? 'æ ‡ç­¾' : key === 'time' ? 'æ—¶é—´' : key === 'desc' ? 'æè¿°' : key === 'record' ? 'å†å¹´è®°å½•' : key === 'date' ? 'æ—¥æœŸ' : key;
            const newVal = prompt(`ç¼–è¾‘${title}`, oldVal);
            if (newVal === null || !newVal.trim()) return;
            // æ—¥æœŸæ ¼å¼äºŒæ¬¡éªŒè¯
            if (key === "date" && !/^\d{1,2}-\d{1,2}$/.test(newVal.trim())) {
                alert("æ—¥æœŸæ ¼å¼è¯·å¡«å†™ æœˆ-æ—¥ï¼Œå¦‚ï¼š12-6ï½"); 
                return;
            }
            // æ›´æ–°æ•°æ®
            if (subType) {
                res[subType][idx][key] = newVal.trim();
            } else {
                res[idx][key] = newVal.trim();
            }
            // å†™å…¥äº‘ç«¯å¹¶é‡æ–°æ¸²æŸ“
            if (await setCloudData(type, res)) await renderAll();
        }

        // 4. é€šç”¨å›¾ç‰‡ä¸Šä¼ ï¼ˆäº‘ç«¯ç‰ˆï¼ŒBase64å­˜å‚¨ï¼ŒåŒæ–¹å¯è§ï¼‰
        async function uploadImg(key, elId, fileEl) {
            const file = fileEl.files[0]; 
            if (!file) return;
            // é™åˆ¶å›¾ç‰‡å¤§å°ï¼ˆ5Mï¼‰
            if (file.size > 5 * 1024 * 1024) { 
                alert("å›¾ç‰‡å¤§å°è¯·æ§åˆ¶åœ¨5Mä»¥å†…å“¦ï½"); 
                return; 
            }
            const reader = new FileReader();
            reader.onload = async e => {
                await setCloudData(key, e.target.result);
                const imgEl = document.getElementById(elId);
                imgEl && (imgEl.src = e.target.result);
                fileEl.value = ""; // æ¸…ç©ºæ–‡ä»¶é€‰æ‹©
            };
            reader.readAsDataURL(file);
        }

        // æ¨¡å—å†…å›¾ç‰‡ä¸Šä¼ ï¼ˆæ•…äº‹/åˆç…§ï¼‰
        async function uploadModuleImg(type, idx, subType, fileEl) {
            const file = fileEl.files[0]; 
            if (!file) return;
            if (file.size > 5 * 1024 * 1024) { 
                alert("å›¾ç‰‡å¤§å°è¯·æ§åˆ¶åœ¨5Mä»¥å†…å“¦ï½"); 
                return; 
            }
            const reader = new FileReader();
            reader.onload = async e => {
                const res = await getCloudData(type);
                if (subType) {
                    res[subType][idx].img = e.target.result;
                } else {
                    res[idx].img = e.target.result;
                }
                await setCloudData(type, res);
                await renderAll();
                fileEl.value = "";
            };
            reader.readAsDataURL(file);
        }

        // 5. å„æ¨¡å—æ¸²æŸ“ï¼ˆå¼‚æ­¥ï¼Œä»äº‘ç«¯å–æ•°ï¼Œå…¼å®¹æœ¬åœ°ï¼‰
        async function renderStories() {
            const list = await getCloudData("stories"), el = document.getElementById("storyTimeline");
            if (!el) return;
            el.innerHTML = list.map((item, i) => `
                <div class="story-item">
                    <div class="story-content">
                        <button class="del del-md" style="top:10px;right:10px;background:#ffe6ef;color:#ff7a9d;" onclick="delData('stories',${i})">Ã—</button>
                        <div class="story-tag" onclick="editData('stories',${i},'tag')">${item.tag}</div>
                        <div class="story-time" onclick="editData('stories',${i},'time')">${item.time}</div>
                        <div class="story-text" onclick="editData('stories',${i},'text')">${item.text}</div>
                        <div class="img-box story-img-box" onclick="document.getElementById('storyImg${i}').click()">
                            <img src="${item.img}" class="img">
                            <div class="img-upload">æ›´æ¢å›¾ç‰‡</div>
                            <input type="file" class="img-input" id="storyImg${i}" accept="image/*" onchange="uploadModuleImg('stories',${i},null,this)">
                        </div>
                    </div>
                </div>
            `).join("");
        }

        // åˆç…§æ¸²æŸ“ï¼šæ–°å¢åˆ é™¤åŠŸèƒ½ + ä¿®å¤æ›´æ¢/é¢„è§ˆå›¾ç‰‡äº‹ä»¶å†²çª
        async function renderPhotos() {
            const data = await getCloudData("photos");
            if (!data) return;
            // éå†æ—¥å¸¸/æ—…è¡Œ/èŠ‚æ—¥ä¸‰ç±»åˆç…§
            Object.keys(data).forEach(type => {
                const list = data[type], 
                      el = document.getElementById(`photo${type.charAt(0).toUpperCase()+type.slice(1)}`);
                if (!el) return;
                el.innerHTML = list.map((item, i) => `
                    <div class="item photo-item" style="position: relative;">
                        <!-- æ–°å¢ï¼šå³ä¸Šè§’åˆ é™¤æŒ‰é’® - æ‚¬æµ®æ˜¾ç¤ºï¼Œç‚¹å‡»ç¡®è®¤åˆ é™¤ -->
                        <button class="del del-sm photo-del" 
                                style="top: 8px; right: 8px; background: #f0e8ff; color: #9d8cff; z-index: 10;"
                                onclick="delPhoto('${type}', ${i})">Ã—</button>
                        <!-- å›¾ç‰‡å®¹å™¨ï¼šé¢„è§ˆ+æ›´æ¢å›¾ç‰‡ï¼ˆå·²ä¿®å¤äº‹ä»¶å†²çªï¼‰ -->
                        <div class="img-box photo-img-box" onclick="previewPhoto('${item.img}')">
                            <img src="${item.img}" class="img">
                            <div class="img-upload photo-img-upload" 
                                 onclick="event.stopPropagation();document.getElementById('photoImg${type}${i}').click()">
                                æ›´æ¢å›¾ç‰‡
                            </div>
                            <input type="file" class="img-input" id="photoImg${type}${i}" accept="image/*" 
                                   onchange="uploadModuleImg('photos',${i},'${type}',this)"
                                   onclick="event.stopPropagation()">
                        </div>
                        <div class="photo-desc" onclick="editData('photos',${i},'desc','${type}')">${item.desc}</div>
                    </div>
                `).join("");
            });
        }

// æ–°å¢ï¼šåˆç…§ä¸“å±åˆ é™¤æ–¹æ³• - å¼¹çª—ç¡®è®¤+è°ƒç”¨é€šç”¨åˆ é™¤æ¥å£ï¼Œé˜²æ­¢è¯¯åˆ 
function delPhoto(type, idx) {
    if (confirm("ç¡®å®šè¦åˆ é™¤è¿™å¼ ç”œèœœåˆç…§å—ï¼Ÿåˆ é™¤åæ— æ³•æ¢å¤å“¦ï½")) {
        delData('photos', idx, type);
    }
}

        async function renderAnni() {
            const list = await getCloudData("anniversaries"), el = document.getElementById("anniWrap");
            if (!el) return;
            el.innerHTML = list.map((item, i) => {
                const color = `color${(i%6)+1}`, count = getAnniCount(item.date);
                return `
                    <div class="anni-card ${color}">
                        <button class="del del-md anni-del" onclick="delData('anniversaries',${i})">Ã—</button>
                        <div class="anni-title" onclick="editData('anniversaries',${i},'name')">${item.name}</div>
                        <div class="anni-time" onclick="editData('anniversaries',${i},'date')">æ¯å¹´${item.date}</div>
                        <div class="anni-count">${count}</div>
                        <div class="anni-record" onclick="editData('anniversaries',${i},'record')">${item.record}</div>
                    </div>
                `;
            }).join("");
        }

        // çºªå¿µæ—¥å€’è®¡æ—¶è®¡ç®—
        function getAnniCount(date) {
            if (date === "X-X" || !date) return "å¾…è®¾ç½®æ—¥æœŸ";
            const [m, d] = date.split("-").map(Number), now = new Date();
            let next = new Date(now.getFullYear(), m-1, d);
            if (next < now) next = new Date(now.getFullYear()+1, m-1, d);
            const days = Math.floor((next - now)/86400000);
            return days === 0 ? "ä»Šå¤©å“¦ğŸ’“" : `${days}å¤©å`;
        }

        async function renderThings() {
            const list = await getCloudData("things"), el = document.getElementById("thingsWrap"), addEl = document.querySelector(".things-add");
            if (!el || !addEl) return;
            // 100ä»¶æ»¡é¢éšè—æ·»åŠ æŒ‰é’®
            if (list.length >= 100) {
                addEl.innerHTML = "<div style='color:#73d89f;text-align:center;'>ğŸ’“ 100ä»¶å°äº‹å·²æ”¶é›†æ»¡ï¼Œä½™ç”Ÿæ…¢æ…¢å®Œæˆï½</div>";
            } else {
                addEl.innerHTML = `<input type="text" class="input" id="thingsText" placeholder="è¾“å…¥è¦ä¸€èµ·åšçš„å°äº‹"><button class="btn" onclick="addData('things', {text:thingsText.value,done:false})">æ·»åŠ å°äº‹</button>`;
            }
            el.innerHTML = list.map((item, i) => `
                <div class="item things-item">
                    <button class="del del-sm things-del" onclick="delData('things',${i})">Ã—</button>
                    <div class="things-check ${item.done?'done':''}" onclick="toggleDone(${i})"></div>
                    <div class="things-text" onclick="editData('things',${i},'text')">${item.text}</div>
                </div>
            `).join("");
        }

        // åˆ‡æ¢å°äº‹å®ŒæˆçŠ¶æ€
        async function toggleDone(idx) {
            const list = await getCloudData("things");
            list[idx].done = !list[idx].done;
            await setCloudData("things", list);
            await renderThings();
        }

        // ç•™è¨€æ¸²æŸ“ï¼ˆæ ¸å¿ƒä¿®å¤ï¼šåˆ é™¤BUG+å®šä½æœ€æ–°ç•™è¨€ï¼‰
        async function renderMsg() {
            const list = await getCloudData("messages"), el = document.getElementById("msgList");
            if (!el) return;
            el.innerHTML = list.map((item, i) => `
                <div class="msg-card ${item.role==='you'?'yours':''}">
                    <button class="del del-sm msg-del" onclick="delData('messages',${i})">Ã—</button>
                    <div class="msg-time">${item.time}</div>
                    <div class="msg-content">${item.text}</div>
                </div>
            `).join("");
            // å§‹ç»ˆæ»šåŠ¨åˆ°æœ€æ–°ç•™è¨€ï¼ˆåº•éƒ¨ï¼‰
            el.scrollTop = el.scrollHeight;
        }

        // å‘é€ç•™è¨€ï¼ˆäº‘ç«¯ç‰ˆï¼Œå…¼å®¹æœ¬åœ°ï¼‰
        async function sendMsg() {
            const msgInput = document.getElementById("msgInput");
            if (!msgInput) return;
            const val = msgInput.value.trim();
            if (!val) { 
                alert("è¯·å†™ä¸‹æƒ³å¯¹å¯¹æ–¹è¯´çš„ç”œè¨€èœœè¯­å“¦ï½"); 
                return; 
            }
            // è·å–ç•™è¨€è§’è‰²
            const roleMe = document.getElementById("roleMe");
            const role = roleMe && roleMe.checked ? "me" : "you";
            // æ ¼å¼åŒ–å½“å‰æ—¶é—´
            const now = new Date(), 
                  time = `${now.getFullYear()}-${(now.getMonth()+1).toString().padStart(2,0)}-${now.getDate().toString().padStart(2,0)} ${now.getHours().toString().padStart(2,0)}:${now.getMinutes().toString().padStart(2,0)}`;
            // è·å–åŸæœ‰ç•™è¨€å¹¶æ·»åŠ æ–°ç•™è¨€
            const list = await getCloudData("messages");
            list.push({role, text:val, time});
            // å†™å…¥äº‘ç«¯å¹¶é‡æ–°æ¸²æŸ“
            if (await setCloudData("messages", list)) {
                msgInput.value = "";
                await renderMsg();
                updateScrollMsg(); // æ›´æ–°æ»šåŠ¨æ å†…å®¹
            }
        }

        // åŠ¨æ€æ›´æ–°å¯¼èˆªæ ä¸‹æ»šåŠ¨æ å†…å®¹ï¼ˆæ˜¾ç¤ºæœ€æ–°3æ¡ç•™è¨€ï¼‰
        async function updateScrollMsg() {
            const list = await getCloudData("messages");
            const scrollEl = document.getElementById("msgScrollContent");
            if (!scrollEl) return;
            if (list.length === 0) {
                scrollEl.innerHTML = "<span>æ¬¢è¿æ¥åˆ°æˆ‘ä»¬çš„æ‹çˆ±æ˜Ÿçƒï¼Œå†™ä¸‹ç¬¬ä¸€æ¡ç”œè¨€èœœè¯­å§ï½</span>";
                return;
            }
            // å–æœ€æ–°3æ¡ç•™è¨€ï¼Œå€’åºæ’åˆ—ï¼Œæ‹¼æ¥æˆæ»šåŠ¨å†…å®¹
            const latestMsgs = list.slice(-3).reverse();
            let scrollContent = "";
            latestMsgs.forEach(item => {
                const name = item.role === "me" ? "æ˜Šå®‡" : "å˜‰è½©";
                scrollContent += `<span>${name}ï¼š${item.text}</span>`;
            });
            scrollEl.innerHTML = scrollContent || "<span>åŒå‘å¥”èµ´çš„æ¸©æŸ”ï¼Œè—åœ¨æ¯ä¸€å¥ç”œè¨€èœœè¯­é‡Œï½</span>";
        }

        // 6. æƒ…ä¾£æ¡£æ¡ˆå·¥å…·
        function editText(el) {
            const old = el.innerText.trim(), val = prompt("ç¼–è¾‘ä¸“å±å°ç»†èŠ‚", old);
            val && val.trim() && (el.innerText = val.trim());
        }

        function addTag(elId, inputEl) {
            const val = inputEl.value.trim();
            if (!val) { 
                alert("è¯·è¾“å…¥ä¸“å±æ ‡ç­¾å“¦ï½"); 
                return; 
            }
            const el = document.getElementById(elId);
            el && (el.innerHTML += `<span class="edit-tag">${val}<span class="tag-del" onclick="this.parentElement.remove()">Ã—</span></span>`);
            inputEl.value = "";
        }

        // 7. é€šç”¨åŠŸèƒ½ï¼šç…§ç‰‡é¢„è§ˆ+æ»šåŠ¨äº‹ä»¶
        function previewPhoto(img) {
            const maskImg = document.getElementById("maskImg");
            const photoMask = document.getElementById("photoMask");
            if (maskImg && photoMask) {
                maskImg.src = img;
                photoMask.classList.add("show");
            }
        }

        function initPreview() { 
            window.previewPhoto = previewPhoto; 
        }

        // æ»šåŠ¨äº‹ä»¶ï¼ˆå¯¼èˆªæ æ ·å¼+æ¨¡å—æ˜¾éš+å›åˆ°é¡¶éƒ¨ï¼‰
        function initScroll() {
            const nav = document.getElementById("nav"), 
                  backTop = document.getElementById("backTop"), 
                  sections = document.querySelectorAll(".section"), 
                  links = document.querySelectorAll(".nav-link");
            if (!nav || !backTop) return;
            window.onscroll = () => {
                const st = document.documentElement.scrollTop || document.body.scrollTop;
                // å¯¼èˆªæ æ ·å¼åˆ‡æ¢
                st > 50 ? nav.classList.add("scroll") : nav.classList.remove("scroll");
                // å›åˆ°é¡¶éƒ¨æŒ‰é’®æ˜¾éš
                st > 300 ? backTop.classList.add("show") : backTop.classList.remove("show");
                // æ¨¡å—æ»šåŠ¨æ˜¾éšåŠ¨ç”»
                sections.forEach(s => {
                    if (s.getBoundingClientRect().top < window.innerHeight * 0.8) s.classList.add("show");
                });
                // å¯¼èˆªæ é“¾æ¥é«˜äº®ï¼ˆè·Ÿéšæ»šåŠ¨ï¼‰
                sections.forEach(s => {
                    const top = s.offsetTop - 100, id = s.id;
                    if (st >= top) {
                        links.forEach(l => l.closest("li").classList.remove("active"));
                        const activeLink = document.querySelector(`.nav-link[href="#${id}"]`);
                        activeLink && activeLink.closest("li").classList.add("active");
                    }
                });
            };
            // åˆå§‹åŒ–å¯¼èˆªé«˜äº®
            links[0] && links[0].closest("li").classList.add("active");
        }

        // æ¸²æŸ“æ‰€æœ‰æ¨¡å—ï¼ˆå¼‚æ­¥ï¼Œåšå¼‚å¸¸æ•è·ï¼‰
        async function renderAll() {
            try {
                await renderStories();
                await renderPhotos();
                await renderAnni();
                await renderThings();
                await renderMsg();
                // æ¸²æŸ“å¤´åƒï¼ˆä»äº‘ç«¯è·å–ï¼‰
                const avatarMe = document.getElementById("avatarMe");
                const avatarYou = document.getElementById("avatarYou");
                if (avatarMe) avatarMe.src = await getCloudData("avatar_me");
                if (avatarYou) avatarYou.src = await getCloudData("avatar_you");
                // åŠ¨æ€æ›´æ–°æ»šåŠ¨æ 
                await updateScrollMsg();
                // æ¯åˆ†é’Ÿæ›´æ–°ä¸€æ¬¡çºªå¿µæ—¥å€’è®¡æ—¶
                setInterval(async () => await renderAnni(), 60000);
            } catch (e) {
                console.log("æ¸²æŸ“æ¨¡å—æ—¶å‡ºç°å°é—®é¢˜ï¼š", e);
            }
        }
    </script>
</body>
</html>
